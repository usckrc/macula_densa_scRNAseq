---
title: "MaculaSO5"
author: "jeff karnsomprot"
date: "2025-04-18"
output:
  html_document: 
    toc: yes
    toc_depth: 3
    toc_float: true
    number_sections: yes
    theme: journal
    df_print: paged
    code_folding: hide
    highlight: pygments

---
# Macula Densa Project

## Objectives 

Three Main Goals of this File <br>
Produce Cleaner looking code. <br> 
Identify the amount of clusters there are <br>
Identify the top genes expressed in each of the clusters <br>


## Problems I need to Fix
Save things as RDS file so I dont have to rerun the whole code

# Loading in Data sets + Library packages.

```{r load new packages, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

if (!require("dplyr")) {install.packages("dplyr"); require("dplyr")}
if (!require("Seurat")) {install.packages("Seurat"); require("Seurat")}
if (!require("patchwork")) {install.packages("patchwork"); require("patchwork")}
if (!require("knitr")) {install.packages("knitr"); require("knitr")}
if (!require("ggplot2")) {install.packages("ggplot2"); require("ggplot2")}
if (!require("BiocManager")) {install.packages("BiocManager"); require("BiocManager")}
if (!require("tibble")) {install.packages("tibble"); require("tibble")}
if (!require("ggpmisc")) {install.packages("ggpmisc"); require("ggpmisc")}
if (!require("RColorBrewer")) {install.packages("RColorBrewer"); require("RColorBrewer")} #color
if (!require("ggrepel")) {install.packages("ggrepel"); require("ggrepel")}
if (!require("DESeq2")) {BiocManager::install('DESeq2'); require("DESeq2")}
if (!require("here")) {install.packages("here"); require("here")}
if (!require("stringr")) {install.packages("stringr"); require("stringr")}
if (!require("car")) {install.packages("car"); require("car")}
if (!require("openxlsx")) {install.packages("openxlsx"); require("openxlsx")}
if (!require("readxl")) {install.packages("readxl"); require("readxl")}
if (!require("data.table")) {install.packages("data.table"); require("data.table")}
if (!require("ggvenn")) {install.packages("ggvenn"); require("ggvenn")}
if (!require("kableExtra")) {install.packages("kableExtra"); require("kableExtra")} # for color brewer
if (!require("gplots")) {install.packages("gplots"); require("gplots")} # for color brewer
if (!require("clusterProfiler")) {BiocManager::install('clusterProfiler'); require("clusterProfiler")}
if (!require("enrichplot")) {BiocManager::install('enrichplot'); require("enrichplot")}
if (!require("tidyverse")) {install.packages("tidyverse"); require("tidyverse")} # for data frame transformation
if (!require("plotly")) {install.packages("plotly"); require("plotly")}
library("EnhancedVolcano")


```


```{r}
options(future.globals.maxSize = 74 * 1024^3) # 55 GB
getOption("future.globals.maxSize") #59055800320
```

``` {r}

SO5 <- LoadSeuratRds(here("jk_code", "SO5.rds"))

head(SO5@meta.data)


```

# Analyzing the SO5 DATASET
``` {r}

DimPlot(SO5,split.by ="sample")
DimPlot(SO5)


```
Based off this I can see that 

SO1-> control
SO2 -> low_salt 
SO3 -> low_salt 
SO4 -> control

```{r}

SO5 <- FindNeighbors(SO5, dims = 1:30, verbose = F)
SO5 <- FindClusters(SO5, resolution = 0.25)

SO5m <- FindAllMarkers(SO5, only.pos = TRUE)
SO5m %>%
    group_by(cluster) %>%
    dplyr::filter(avg_log2FC > 1)

SO5m %>%
    group_by(cluster) %>%
    dplyr::filter(avg_log2FC > 1) %>%
    slice_head(n = 5) %>%
    ungroup() -> top10
DoHeatmap(SO5, features = top10$gene) + NoLegend()
DimPlot(SO5)
FeaturePlot(SO5,"S100g",split.by = "treatment") #cluster
FeaturePlot(SO5,"Junb",split.by = "treatment") # cluster
FeaturePlot(SO5,"Cxcl10",split.by = "treatment") # cluster
FeaturePlot(SO5,"Pappa2",split.by = "treatment")
DimPlot(SO5,split.by = "treatment")

```

# Identifying Clusters

## Cluster 5
``` {r}

# Cxcl10
FeaturePlot(SO5, features = "Cxcl10", split.by = "treatment")

# Ifit1
FeaturePlot(SO5, features = "Ifit1", split.by = "treatment",order = TRUE)

# Isg15
FeaturePlot(SO5, features = "Isg15", split.by = "treatment",order = TRUE)

# Gbp10
FeaturePlot(SO5, features = "Gbp10", split.by = "treatment")

# Ifi47
FeaturePlot(SO5, features = "Ifi47", split.by = "treatment")

```

## Cluster 4

``` {r}

# Fos
FeaturePlot(SO5, features = "Fos", split.by = "treatment")

# Junb
FeaturePlot(SO5, features = "Junb", split.by = "treatment")

# Egr1
FeaturePlot(SO5, features = "Egr1", split.by = "treatment")

# Fosb
FeaturePlot(SO5, features = "Fosb", split.by = "treatment")

# Zfp36
FeaturePlot(SO5, features = "Zfp36", split.by = "treatment")

```

## Cluster 2

```{r}

# Egf
FeaturePlot(SO5, features = "Egf", split.by = "treatment")

# Krt7
FeaturePlot(SO5, features = "Krt7", split.by = "treatment")

# Fabp3
FeaturePlot(SO5, features = "Fabp3", split.by = "treatment")

# Cldn19
FeaturePlot(SO5, features = "Cldn19", split.by = "treatment")

# Tmem52b
FeaturePlot(SO5, features = "Tmem52b", split.by = "treatment")

```

## Cluster 0 

```{r}

# Mcub
FeaturePlot(SO5, features = "Mcub", split.by = "treatment")

# Aard
FeaturePlot(SO5, features = "Aard", split.by = "treatment")

# Fetub
FeaturePlot(SO5, features = "Fetub", split.by = "treatment")


```
Observation : MCUB seems to be the highly defined gene in low salt

## Cluster 1
```{r}

# S100g
FeaturePlot(SO5, features = "S100g", split.by = "treatment")

```
## Cluster 3

```{r}

# Leng9
FeaturePlot(SO5, features = "Leng9", split.by = "treatment")

```
# Subset Cluster 0, 1, 3

```{r}
# SO6 checking another cluster
SO6<- subset(SO5, idents = c("0","1","3"))

SO6 <- FindNeighbors(SO6, dims = 1:30, verbose = F)
SO6 <- FindClusters(SO6, resolution = 0.1)

DimPlot(SO6,split.by = "sample")
SO6m <- FindAllMarkers(SO6, only.pos = TRUE)
SO6m %>%
    group_by(cluster) %>%
    dplyr::filter(avg_log2FC > 0.5)

DimPlot(SO6,split.by = "sample")

DimPlot(SO6,split.by = "sample", group.by = "treatment" )
head(SO6@meta.data)

FeaturePlot(SO6,"Pappa2",split.by = "sample")


```

## Clusters

```{r}

# S100g
FeaturePlot(SO6, features = "S100g")

# Aard
FeaturePlot(SO6, features = "Aard")

# Mcub
FeaturePlot(SO6, features = "Mcub")
DimPlot(SO6,group.by = "sample",split.by = "sample")
DimPlot(SO6,group.by = "treatment",split.by = "sample")

```

My guess is that these are the same, As you go from control to low_salt the cells start to express different genes. 
How can I test this? 

I think the next step after I figure out something with these clusters is to figure out what each of these top genes do, the functions, and purpose of them.


Next Steps: 
Take a Few steps back and identify S100g Cluster 

Multidimensional Dotplot (top genes that are expressed)

Possibly Filter out Rp genes for 
maybe mt too

```{r}



``` 


